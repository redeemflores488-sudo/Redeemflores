<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Portal - Courses</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
    :root {
        --sidebar: #0f1117;
        --accent: #6ee7b7;
        --surface: #1a1d27;
        --card: #21253a;
        --text: #e2e8f0;
        --muted: #64748b;
        --danger: #f87171;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: var(--sidebar); color: var(--text); font-family: 'DM Sans', sans-serif; min-height: 100vh; display: block; }

    /* SIDEBAR: Hidden on phone by default */
    .sidebar { 
        display: none; 
    }

    /* MAIN: Takes full width on phone */
    .main { 
        margin-left: 0; 
        padding: 20px; 
        width: 100%; 
    }

    .page-title { font-family: 'Syne', sans-serif; font-size: 1.8rem; font-weight: 800; color: var(--text); }
    .page-subtitle { color: var(--muted); font-size: 0.85rem; margin-bottom: 24px; }

    /* LAYOUT: Stack form on top of table */
    .layout { 
        display: flex; 
        flex-direction: column; 
        gap: 20px; 
    }

    .form-card { background: var(--card); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.06); }
    .form-control-dark { background: var(--surface); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: var(--text); padding: 12px; width: 100%; margin-bottom: 10px; }
    .btn-accent { background: var(--accent); color: #0f1117; border: none; border-radius: 8px; padding: 12px; font-weight: 700; width: 100%; }

    /* TABLE: The scrollable container */
    .table-card { 
        background: var(--card); 
        border-radius: 12px; 
        border: 1px solid rgba(255,255,255,0.06); 
        overflow-x: auto; /* Allows you to swipe left/right to see credits */
        width: 100%;
    }
    
    table { width: 100%; border-collapse: collapse; min-width: 500px; }
    thead th { padding: 10px; font-size: 0.65rem; color: var(--muted); text-transform: uppercase; text-align: left; }
    td { padding: 12px 10px; font-size: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.04); }

    .badge-credits { background: rgba(110,231,183,0.12); color: var(--accent); padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; }
</style>

</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-logo">ðŸŽ“ EduPortal</div>
        <div class="sidebar-sub">School Management</div>
        <a href="index.html" class="nav-link">Dashboard</a>
        <a href="student.html" class="nav-link">Students</a>
        <a href="courses.html" class="nav-link active">Courses</a>
    </aside>

    <main class="main">
        <div class="page-title">Courses</div>
        <div class="page-subtitle">Create and manage courses available for enrollment.</div>

        <div class="layout">
            <div class="form-card">
                <div id="formTitle" style="color:var(--accent); font-weight:bold; margin-bottom:20px;">ðŸ“š Add New Course</div>
                <input type="hidden" id="courseId">
                <div class="form-group">
                    <label style="font-size:0.7rem; color:var(--muted)">TITLE</label>
                    <input type="text" class="form-control-dark" id="title" placeholder="e.g. Introduction to CS">
                </div>
                <div class="form-group">
                    <label style="font-size:0.7rem; color:var(--muted)">DESCRIPTION</label>
                    <input type="text" class="form-control-dark" id="description" placeholder="Brief description">
                </div>
                <div class="form-group">
                    <label style="font-size:0.7rem; color:var(--muted)">CREDITS</label>
                    <input type="number" class="form-control-dark" id="credits" placeholder="e.g. 3">
                </div>
                <button class="btn-accent" id="submitBtn" onclick="saveCourse()">Save Course</button>
            </div>

            <div class="table-card">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Credits</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="courseList">
                        <tr><td colspan="5" style="text-align:center; padding:40px; color:var(--muted)">Loading courses...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // FIXED: URL works on both Railway and Localhost
        const API = `${window.location.origin}/courses`;

        async function fetchCourses() {
            try {
                const res = await fetch(API);
                const courses = await res.json();
                const tbody = document.getElementById('courseList');

                if (!courses || courses.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding:40px; color:var(--muted)">No courses found.</td></tr>`;
                    return;
                }

                tbody.innerHTML = courses.map(c => `
                    <tr>
                        <td style="color:var(--muted)">#${c.id}</td>
                        <td><strong>${c.title}</strong></td>
                        <td style="color:var(--muted)">${c.description}</td>
                        <td><span class="badge-credits">${c.credits} cr</span></td>
                        <td>
                            <button class="btn-delete" onclick="deleteCourse(${c.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                document.getElementById('courseList').innerHTML = `<tr><td colspan="5" style="text-align:center; color:var(--danger)">Failed to load data.</td></tr>`;
            }
        }

        async function saveCourse() {
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const credits = parseInt(document.getElementById('credits').value);

            if (!title || !description || !credits) return alert('Fill all fields');

            await fetch(API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, description, credits })
            });

            document.getElementById('title').value = '';
            document.getElementById('description').value = '';
            document.getElementById('credits').value = '';
            fetchCourses();
        }

        async function deleteCourse(id) {
            if (!confirm('Delete?')) return;
            await fetch(`${API}/${id}`, { method: 'DELETE' });
            fetchCourses();
        }

        fetchCourses();
    </script>
</body>
</html>
